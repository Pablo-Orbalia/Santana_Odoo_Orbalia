<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <!-- VISTA KANBAN -->
  <record id="orbalia_project_kanban" model="ir.ui.view">
    <field name="name">orbalia.project.kanban</field>
    <field name="model">orbalia.project</field>
    <field name="arch" type="xml">
      <kanban class="o_kanban_small_column o_kanban_grouped"
              default_group_by="stage_id">

        <field name="title"/>
        <field name="partner_id"/>
        <field name="stage_id"/>
        <field name="grant_call_id"/>

        <templates>
          <t t-name="kanban-box">
            <t t-set="state" t-value="record.stage_id.raw_value or ''"/>
            <div t-attf-class="o_kanban_record oe_kanban_global_click o_kanban_#{state}">
              <div class="o_kanban_primary_left">
                <strong class="fw-bold" t-esc="record.title.value"/>
              </div>
              <div class="o_kanban_secondary_bottom text-muted mt-1">
                <i class="fa fa-building-o me-1"/>
                <t t-esc="record.partner_id.value"/>
              </div>
            </div>
          </t>
        </templates>

      </kanban>
    </field>
  </record>

  <!-- VISTA LIST -->
  <record id="orbalia_project_list" model="ir.ui.view">
    <field name="name">orbalia.project.list</field>
    <field name="model">orbalia.project</field>
    <field name="arch" type="xml">
      <list string="Subvenciones">
        <field name="title"/>
        <field name="partner_id"/>
        <field name="grant_call_id"/>
        <field name="stage_id"/>
        <field name="state"/>
        <field name="importe_solicitado"/>
        <field name="importe_concedido"/>
        <field name="fecha_solicitud"/>
      </list>
    </field>
  </record>

  <!-- VISTA FORM -->
  <record id="orbalia_project_form" model="ir.ui.view">
    <field name="name">orbalia.project.form</field>
    <field name="model">orbalia.project</field>
    <field name="arch" type="xml">
      <form string="Subvención">
        <sheet>
          <group>
            <group>
              <field name="title"/>
              <field name="partner_id"/>
              <field name="contacto_primario_id" domain="[('parent_id','=',partner_id)]"/>
              <field name="grant_call_id"/>
              <field name="stage_id" domain="[('grant_call_id','=',grant_call_id)]"/>
              <field name="state"/>
            </group>
            <group>
              <field name="importe_solicitado"/>
              <field name="importe_concedido"/>
              <field name="fecha_solicitud"/>
              <field name="fecha_resolucion"/>
              <field name="fecha_justificacion"/>
              <field name="fecha_limite_justificacion"/>
            </group>
          </group>
          <notebook>
            <page string="Información">
              <group>
                <field name="organismo"/>
                <field name="convocatoria"/>
                <field name="nombre_subvencion"/>
                <field name="punto_solicitud"/>
                <field name="url_drive"/>
                <field name="enlace_colaborador"/>
              </group>
            </page>
            <page string="Descripción">
              <field name="nota" nolabel="1"/>
            </page>
          </notebook>
        </sheet>
      </form>
    </field>
  </record>

  <!-- ACCIÓN (kanban,list,form) -->
  <record id="action_orbalia_project" model="ir.actions.act_window">
    <field name="name">Subvenciones</field>
    <field name="res_model">orbalia.project</field>
    <field name="view_mode">kanban,list,form</field>
    <field name="views" eval="[
      [ref('orbalia_project_kanban'), 'kanban'],
      [ref('orbalia_project_list'), 'list'],
      [ref('orbalia_project_form'), 'form']
    ]"/>
    <field name="domain">[('grant_call_id', '=', context.get('active_id'))]</field>
    <field name="context">
      {
        "default_grant_call_id": context.get("active_id"),
        "group_by": "stage_id"
      }
    </field>
  </record>

  <!-- MENÚ (si no quieres menú, elimina todo este bloque) -->
  <menuitem id="menu_orbalia_projects"
            name="Subvenciones"
            parent="base.menu_administration"
            action="action_orbalia_project"/>

</odoo>
