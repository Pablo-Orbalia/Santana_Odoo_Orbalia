<odoo>

  <!-- 1) Vista formulario -->
  <record id="view_orbalia_project_form" model="ir.ui.view">
    <field name="name">orbalia.project.form</field>
    <field name="model">orbalia.project</field>
    <field name="arch" type="xml">
      <form string="Subvención">
        <sheet>
          <group>
            <group>
              <field name="name" readonly="1"/>
              <field name="title"/>
              <field name="partner_id" string="Entidad solicitante"/>
              <field name="organismo"/>
              <field name="convocatoria"/>
            </group>
            <group>
              <field name="importe_solicitado"/>
              <field name="importe_concedido"/>

              <!-- FECHAS -->
              <field name="fecha_solicitud"/>
              <field name="fecha_resolucion"/>
              <field name="fecha_justificacion"/>
              <field name="fecha_limite_justificacion"/>

              <field name="state" widget="statusbar"
                     statusbar_visible="draft,submitted,awarded,rejected,cancel"/>

              <!-- NUEVO: Etapa configurable para Kanban -->
              <field name="stage_id"/>
            </group>
          </group>

          <notebook>
            <page string="Notas">
              <field name="nota"/>
            </page>
          </notebook>
        </sheet>
      </form>
    </field>
  </record>

  <!-- 2) Vista lista -->
  <record id="view_orbalia_project_tree" model="ir.ui.view">
    <field name="name">orbalia.project.tree</field>
    <field name="model">orbalia.project</field>
    <field name="arch" type="xml">
      <list string="Subvenciones">
        <field name="name"/>
        <field name="title"/>
        <field name="partner_id"/>
        <field name="organismo"/>
        <field name="convocatoria"/>
        <field name="importe_concedido"/>
        <field name="fecha_justificacion"/>
        <field name="fecha_limite_justificacion"/>
        <field name="state"/>
        <field name="stage_id"/>
      </list>
    </field>
  </record>

  <!-- 3) Vista de búsqueda -->
  <record id="view_orbalia_project_search" model="ir.ui.view">
    <field name="name">orbalia.project.search</field>
    <field name="model">orbalia.project</field>
    <field name="arch" type="xml">
      <search>
        <field name="name" string="Código"/>
        <field name="title" string="Título"/>
        <filter string="Borrador"   name="draft"    domain="[('state','=','draft')]"/>
        <filter string="Presentada" name="submitted" domain="[('state','=','submitted')]"/>
        <filter string="Concedida"  name="awarded"  domain="[('state','=','awarded')]"/>
        <filter string="Rechazada"  name="rejected" domain="[('state','=','rejected')]"/>
        <filter string="Cancelada"  name="cancel"   domain="[('state','=','cancel')]"/>
        <!-- Agrupar por etapa (por defecto) -->
        <filter string="Agrupar por etapa" name="group_by_stage" context="{'group_by': 'stage_id'}"/>
        <filter string="Agrupar por estado" name="group_by_state" context="{'group_by': 'state'}"/>
      </search>
    </field>
  </record>

  <!-- 4) Acción principal -->
  <record id="action_orbalia_project" model="ir.actions.act_window">
    <field name="name">Subvenciones</field>
    <field name="res_model">orbalia.project</field>
    <field name="view_mode">kanban,list,form</field>
    <field name="search_view_id" ref="view_orbalia_project_search"/>
    <field name="context">{'search_default_group_by_stage': 1}</field>
  </record>

  <!-- 5) Menús -->
  <menuitem id="menu_orbalia_root" name="Orbalia" sequence="10"/>
  <menuitem id="menu_orbalia_project" name="Subvenciones"
            parent="menu_orbalia_root" action="action_orbalia_project" sequence="10"/>

</odoo>
